(function(){"use strict";var flow;flow=function(flow){var Flow;Flow=function(){var self,stack,timerId;self=void 0;stack=[];timerId=setTimeout(function(){timerId=null;return self._next()},0);return self={destroy:function(){return timerId&&clearTimeout(timerId)},par:function(callback,isSeq){if(isSeq||!(stack[stack.length-1]instanceof Array)){stack.push([])}stack[stack.length-1].push(callback);return self},seq:function(callback){return self.par(callback,true)},_next:function(err,result){var callbacks,errors,i,isSeq,nbReturn,results,results1;errors=[];results=[];callbacks=stack.shift()||[];nbReturn=callbacks.length;isSeq=nbReturn===1;i=0;results1=[];while(i<callbacks.length){(function(fct,index){return fct(function(error,result){errors[index]=error;results[index]=result;if(--nbReturn===0){return self._next(isSeq?errors[0]:errors,isSeq?results[0]:results)}},err,result)})(callbacks[i],i);results1.push(i++)}return results1}}};flow.start=function(){return Flow().seq(flow.createContext).seq(integration.createVirtusizeObject).seq(utils.ensureJQuery).seq(utils.checkBrowser).seq(utils.checkMobileVersion).seq(proxy.setupReceiveMessage).seq(bid.setOnContext).seq(utils.checkEnvironment).seq(integration.handleInitialQueue).seq(view.injectOverlayStyle).seq(utils.debug)};flow.createContext=function(next){return next(false,{})};return flow}(flow||{});var integration;integration=function(integration){var snippetApiSortOrder,virtusizeObjectKey;virtusizeObjectKey="Virtusize";snippetApiSortOrder=["setApiKey","setLanguage","setRegion","setUserId","setWidgetOverlayColor","setMobile","addWidget","addOrder","addFindByFit","on","setAvailableSizes","setSizeAliases","ready"];integration.createVirtusizeObject=function(next,error,context){context.vs=integration.VirtusizeSingleton.get();context.vs.integrationVersion=utils.vsIntegrationVersion;context.vs.snippetVersion=window[window[virtusizeObjectKey]].snippetVersion;return next(false,context)};integration.handleInitialQueue=function(next,error,context){var func,i,item,len,ref;context.queue=window[window[virtusizeObjectKey]];window[window[virtusizeObjectKey]]=context.vs;integration.sortQueue(context.queue);ref=context.queue;for(i=0,len=ref.length;i<len;i++){item=ref[i];func=item.shift();if(utils.$.isFunction(context.vs[func])){context.vs[func].apply(context.vs,item)}item.unshift(func)}return next(false,context)};integration.sortQueue=function(queue){return queue.sort(function(a,b){return utils.$.inArray(a[0],snippetApiSortOrder)-utils.$.inArray(b[0],snippetApiSortOrder)})};integration.VirtusizeSingleton=function(){var Virtusize,instance;function VirtusizeSingleton(){}instance=null;VirtusizeSingleton.get=function(forceNew){if(forceNew==null){forceNew=false}return instance=forceNew||instance==null?new Virtusize:instance};Virtusize=function(){function Virtusize(){this.widgets={};this.orders={};this.findByFit={}}Virtusize.prototype.setApiKey=function(apiKey){return this.apiKey=apiKey};Virtusize.prototype.setUserId=function(userId){return this.userId=userId};Virtusize.prototype.setRegion=function(region){return this.region=region};Virtusize.prototype.setLanguage=function(language){return this.language=language};Virtusize.prototype.setWidgetOverlayColor=function(rgba){return view.injectOverlayStyles(rgba)};Virtusize.prototype.setMobile=function(isMobile){return mobile.isMobile=isMobile};Virtusize.prototype.isMobile=function(){if(mobile.isMobile!=null){return mobile.isMobile}else if(this.environment!=null&&this.environment.widgetType==="mobile"){return true}else{return false}};Virtusize.prototype.addWidget=function(){var defaults,w;defaults={region:this.region,language:this.language};if(this.apiKey==null){utils.logError(new utils.Error("Virtusize Widget Integration","API-key is undefined, run `vs.setApiKey`."));return false}switch(arguments.length){case 1:if(utils.isPlainObject(arguments[0])){utils.$.extend(defaults,arguments[0])}else{utils.logError(new utils.Error("Virtusize Widget Integration","argument must be an object, if only one argument is provided."));return false}break;case 2:case 3:defaults.productId=arguments[0];defaults.buttonSelector=arguments[1];break;default:utils.logError(new utils.Error("Virtusize Widget Integration","wrong number of arguments."));return false}if(arguments.length===3){utils.$.extend(defaults,arguments[2])}w=new widget.VirtusizeWidget(defaults);utils.logErrors(w.validate());this.widgets[w.getProductId()]=w;return w};Virtusize.prototype.addFindByFit=function(){var defaults,errors,w;defaults={region:this.region,language:this.language};if(this.apiKey==null){utils.logError(new utils.Error("Virtusize FindbyFit Integration","API-key is undefined, run `vs.setApiKey`."));return false}switch(arguments.length){case 1:if(utils.isPlainObject(arguments[0])){utils.$.extend(defaults,arguments[0])}else{utils.logError(new utils.Error("Virtusize FindbyFit Integration","argument must be an object."));return false}break;default:utils.logError(new utils.Error("Virtusize FindbyFit Integration","wrong number of arguments provided."));return false}w=new findByFit.FbFWidget(defaults);errors=utils.logErrors(w.validate());if(errors.length){return}w.dataReady();return w};Virtusize.prototype.getWidget=function(productId){return this.widgets[productId]};Virtusize.prototype.setAvailableSizes=function(productId,availableSizes){return this.getWidget(productId).setAvailableSizes(availableSizes)};Virtusize.prototype.setSizeAliases=function(productId,sizeAliases){return this.getWidget(productId).setSizeAliases(sizeAliases)};Virtusize.prototype.ready=function(handler){return handler.call(this)};Virtusize.prototype.on=function(productId,eventName,callback){return this.getWidget(productId).on(eventName,callback)};Virtusize.prototype.off=function(productId,eventName,callback){return this.getWidget(productId).off(eventName,callback)};Virtusize.prototype.addOrder=function(){var defaults,o;defaults={apiKey:this.apiKey};if(this.apiKey==null){utils.logError(new utils.Error("Virtusize Order Integration","API-key is undefined, run `vs.setApiKey`."));return false}switch(arguments.length){case 1:if(utils.isPlainObject(arguments[0])){utils.$.extend(defaults,arguments[0])}else{utils.logError(new utils.Error("Virtusize Order Integration","argument must be an object, if only one argument is provided."));return false}break;case 3:defaults.orderId=arguments[0];defaults.userId=arguments[1];utils.$.extend(defaults,arguments[2]);break;default:utils.logError(new utils.Error("Virtusize Order Integration","wrong number of arguments."));return false}o=new order.Order(defaults);utils.logErrors(o.validate());this.orders[o.getOrderId()]=o;return o};return Virtusize}();return VirtusizeSingleton}();return integration}(integration||{});var ogp;ogp=function(ogp){var ogPrefixRegex,ogProperties,productPrefixRegex,productProperties;ogPrefixRegex=/(?:([\S]*):\s?)?http:\/\/ogp.me\/ns#/;productPrefixRegex=/(?:([\S]*):\s?)?http:\/\/ogp.me\/ns\/product\#/;ogProperties=["url","title","image","image:url","image:width","image:height","description","locale","site_name"];productProperties=["upc","ean","brand","mfr_part_no","size","color","availability","category","price:amount","price:currency","material","pattern","target_gender","age_group"];ogp.parse=function(){var metas,ogData;metas=utils.$("meta");ogData={};utils.$.each(metas,function(index,meta){var n,p;meta=utils.$(meta);p=meta.attr("property");n=meta.attr("name");if(ogp.validProperty(p,ogp.concatAllProperties())){return ogp.setData(meta,p,ogData)}else if(ogp.validProperty(n,ogp.concatAllProperties())){return ogp.setData(meta,n,ogData)}});return ogData};ogp.setData=function(meta,property,data){var key,prefixes;prefixes=ogp.parsePrefix(ogp.selectPrefix());key=property.replace(prefixes.og+":","").replace(prefixes.product+":","");if(data[key]&&!utils.$.isArray(data[key])){data[key]=[data[key]]}if(utils.$.isArray(data[key])){data[key].push(meta.attr("content"))}else{data[key]=meta.attr("content")}};ogp.parsePrefix=function(prefixes){var res;res={og:"og",product:"og:product"};if(prefixes.length>0){utils.$.each(prefixes,function(index,prefix){var ogMatch,productMatch;ogMatch=prefix.value.match(ogPrefixRegex);productMatch=prefix.value.match(productPrefixRegex);if(ogMatch&&ogMatch.length===2&&ogMatch[1]){res.og=ogMatch[1]}else if(ogMatch&&prefix.name.match(/xmlns:/)){res.og=prefix.name.replace(/xmlns:/,"")}if(productMatch&&productMatch.length===2&&productMatch[1]){res.product=productMatch[1]}else if(productMatch&&prefix.name.match(/xmlns:/)){res.product=prefix.name.replace(/xmlns:/,"")}else{res.product=res.og+":product"}})}return res};ogp.selectPrefix=function(){var head,html,prefix;html=utils.$("html");head=utils.$("head");prefix=ogp.extractPrefix(head[0]);if(prefix.length===0){prefix=ogp.extractPrefix(html[0])}return prefix};ogp.extractPrefix=function(el){var prefix;prefix=[];utils.$.each(el.attributes,function(index,attr){var p;p={};if(attr.value.match(/ogp\.me/)){p.name=attr.name;p.value=attr.value;return prefix.push(p)}});return prefix};ogp.concatAllProperties=function(){var prefixes;prefixes=ogp.parsePrefix(ogp.selectPrefix());return utils.$.merge(ogp.concatProperties(prefixes.og,ogProperties),ogp.concatProperties(prefixes.product,productProperties))};ogp.concatProperties=function(prefix,props){var res;res=[];utils.$.each(props,function(index,prop){return res.push(prefix+":"+prop)});return res};ogp.validProperty=function(property,validProperties){return property&&utils.$.inArray(property,validProperties)!==-1};return ogp}(ogp||{});var findByFit;findByFit=function(findByFit){findByFit.FbFWidget=function(){function FbFWidget(params){var ref;if(params==null){params={}}this.done=params.done;this.callbacks={};window.vs["findByFit"]={};this.setRegion(params.region);this.setLanguage(params.language);this.containerSelector=(ref=params.containerSelector)!=null?ref:false;this.setGlobal("containerSelector",this.containerSelector);this.errors=[];this.active_stores={"15cc36e1d7dad62b8e11722ce1a245cb6c5e6692":{storeName:"virtusize",storeId:2},d2bee7244870e0284103f6725a4d518c2d1c100d:{storeName:"stayhard",storeId:5},"1a3af6cd7487cc9bc952b8051ce044fb72e238d7":{storeName:"ragtag",storeId:135},"1c6911eb33a240e0bfda5f24e6758cd083d6cd8c":{storeName:"urban_research",storeId:108},d6fd327845b43cf25c8aa2a9c1f0f02ebb41a4e6:{storeName:"flandre",storeId:294},"9a2183af760a9c0c93a56a7489f8681b143f882a":{storeName:"hope",storeId:286}};this.initialize()}FbFWidget.prototype.initialize=function(){var store,vs;vs=integration.VirtusizeSingleton.get();store=this.active_stores[vs.apiKey];if(!store){return false}this.setStoreId(store.storeId);this.setStoreName(store.storeName);return this.setGlobal("store",{id:this.getStoreId(),name:this.getStoreName()})};FbFWidget.prototype.dataReady=function(data){if(data==null){data={}}return this.open()};FbFWidget.prototype.setGlobal=function(key,value){return window.vs["findByFit"][key]=value};FbFWidget.prototype.getStoreName=function(){return this.StoreName};FbFWidget.prototype.setStoreName=function(StoreName){return this.StoreName=StoreName};FbFWidget.prototype.getStoreId=function(){return this.storeId};FbFWidget.prototype.setStoreId=function(storeId){return this.storeId=storeId};FbFWidget.prototype.getLanguage=function(){return this.language};FbFWidget.prototype.setLanguage=function(language){return this.language=language?language:"default"};FbFWidget.prototype.getRegion=function(){return this.region};FbFWidget.prototype.setRegion=function(region){return this.region=region?region:"default"};FbFWidget.prototype.on=function(eventName,callback){var callbackList;callbackList=this.callbacks[eventName]||[];callbackList.push(callback);this.callbacks[eventName]=callbackList;this.handleEvent("integration-registered-callback",{eventName:eventName})};FbFWidget.prototype.off=function(eventName,callback){var callbackList,cb,i,j,len;if(eventName==null){return}this.handleEvent("integration-unregistered-callback",{eventName:eventName});if(callback==null){this.callbacks[eventName]=[];return}callbackList=this.callbacks[eventName]||[];for(i=j=0,len=callbackList.length;j<len;i=++j){cb=callbackList[i];if(cb===callback){callbackList.splice(i,1)}}this.callbacks[eventName]=callbackList};FbFWidget.prototype.handleEvent=function(eventName,data){var callback,callbackList,callbacks,j,len,results;callbacks=this.callbacks;if(!utils.$.isArray(callbacks[eventName])){return}callbackList=callbacks[eventName];results=[];for(j=0,len=callbackList.length;j<len;j++){callback=callbackList[j];try{results.push(callback.apply(this,[data]))}catch(error){}}return results};FbFWidget.prototype.open=function(options){if(options==null){options={}}utils.loadScript(utils.urlFor("/a/find-by-fit/v1/integration.min.js",true));return this.handleEvent("user-opened-widget")};FbFWidget.prototype.validate=function(){this.errors=[];if(!this.containerSelector){this.errors.push(new utils.Error("Virtusize FindbyFit Integration","`containerSelector` is undefined."))}return this.errors};return FbFWidget}();return findByFit}(findByFit||{});var widget,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};widget=function(widget){widget.VirtusizeWidget=function(){function VirtusizeWidget(params){var ref,ref1,ref2,ref3,ref4,ref5;if(params==null){params={}}this.setButtonSelector(params.buttonSelector);this.setButtons(this.buttonSelector);this.setProductVersion(params.productVersion);this.done=params.done;this.active=false;this.validProduct=false;this.callbacks={};this.setRegion(params.region);this.setLanguage(params.language);this.setProductId(params.productId);this.setProductImageUrl(params.productImageUrl);this.setFindByFitSelector((ref=params.findByFitSelector)!=null?ref:false);this.setInpageSelector((ref1=params.inpageSelector)!=null?ref1:false);this.setAvailableSizes(params.availableSizes);this.setSizeAliases(params.sizeAliases);this.setAddToCartEnabled((ref2=params.addToCartEnabled)!=null?ref2:false);this.setTooltipEnabled((ref3=params.tooltipEnabled)!=null?ref3:false);this.setTooltipPosition(params.tooltipPosition!=null&&params.tooltipPosition==="bottom"?"bottom":"top");this.setTooltipStyle(params.tooltipStyle!=null&&params.tooltipStyle==="light"?params.tooltipStyle:"dark");this.setTooltipOpenDelay((ref4=params.tooltipOpenDelay)!=null?ref4:0);this.setTooltipCloseDelay((ref5=params.tooltipCloseDelay)!=null?ref5:null);this.detached=false;this.type=params.type;this.sizeSelector=params.sizeSelector;this.containerSelector=params.containerSelector;this.closeSelector=params.closeSelector;this.zIndex=params.zIndex;this.errors=[];this.ab_test_participants=[];this.initialize()}VirtusizeWidget.prototype.initialize=function(){view.setupDomButtons(this);api.createProductCheck(this);if(this.tooltipEnabled||utils.isFromFindByFit()){view.injectTooltipStyle()}this.on("integration-registered-callback",function(data){if(data.eventName==="user-added-item-to-cart"){return this.setAddToCartEnabled(true)}});return this.on("integration-unregistered-callback",function(data){if(data.eventName==="user-added-item-to-cart"){return this.setAddToCartEnabled(false)}})};VirtusizeWidget.prototype.productChecked=function(data){this.setValidProduct(data.validProduct);this.setStoreProductId(data.productDataId);this.setStoreProductTypeId(data.productTypeId);this.setStoreProductTypeName(data.productTypeName);this.setStoreId(data.storeId);this.setStoreName(data.storeName);this.setFetchMetaData(data.fetchMetaData);this.setUserEventData(data.userData);api.createEvent("user-saw-product",this);if(this.isValidProduct()){if(this.isTestGroup()){if(this.done!=null){this.done.apply(this,[false])}api.createEvent("user-saw-widget-button",this);if(this.doFetchMetaData()){return utils.sendProductMetadata(this)}}else{view.showButtons(this);if(this.done!=null){this.done.apply(this,[false])}api.createEvent("user-saw-widget-button",this);this.handleEvent("user-saw-widget-button");if(utils.isFromFindByFit()){this.showFindByFitInfo()}if(this.getInpageSelector()){this.showInpage()}if(this.doFetchMetaData()){utils.sendProductMetadata(this)}if(this.isTooltipEnabled()&&!this.getInpageSelector()){return this.checkPurchaseHistory()}}}else{if(this.done!=null){return this.done.apply(this,["invalid product"])}}};VirtusizeWidget.prototype.getStoreName=function(){return this.StoreName};VirtusizeWidget.prototype.setStoreName=function(StoreName){return this.StoreName=StoreName};VirtusizeWidget.prototype.getStoreId=function(){return this.storeId};VirtusizeWidget.prototype.setStoreId=function(storeId){return this.storeId=storeId};VirtusizeWidget.prototype.getButtonSelector=function(){return this.buttonSelector};VirtusizeWidget.prototype.setButtonSelector=function(buttonSelector){return this.buttonSelector=buttonSelector};VirtusizeWidget.prototype.getButtons=function(){return this.buttons};VirtusizeWidget.prototype.setButtons=function(buttonSelector){if(buttonSelector!=null){return this.buttons=utils.$(buttonSelector)}};VirtusizeWidget.prototype.getProductVersion=function(){return this.productVersion};VirtusizeWidget.prototype.setProductVersion=function(productVersion){return this.productVersion=productVersion};VirtusizeWidget.prototype.getProductImageUrl=function(){return this.productImageUrl};VirtusizeWidget.prototype.setProductImageUrl=function(productImageUrl){return this.productImageUrl=productImageUrl};VirtusizeWidget.prototype.getFindByFitSelector=function(){return this.findByFitSelector};VirtusizeWidget.prototype.setFindByFitSelector=function(findByFitSelector){return this.findByFitSelector=findByFitSelector};VirtusizeWidget.prototype.getInpageSelector=function(){return this.inpageSelector};VirtusizeWidget.prototype.setInpageSelector=function(inpageSelector){return this.inpageSelector=inpageSelector};VirtusizeWidget.prototype.getProductId=function(){return this.productId};VirtusizeWidget.prototype.setProductId=function(productId){return this.productId=productId!=null?utils.$.trim(""+productId):0};VirtusizeWidget.prototype.getStoreProductId=function(){return this.storeProductId};VirtusizeWidget.prototype.setStoreProductId=function(storeProductId){return this.storeProductId=storeProductId};VirtusizeWidget.prototype.getStoreProductTypeId=function(){return this.storeProductTypeId};VirtusizeWidget.prototype.getStoreProductTypeName=function(){return this.storeProductTypeName};VirtusizeWidget.prototype.setStoreProductTypeId=function(storeProductTypeId){return this.storeProductTypeId=storeProductTypeId};VirtusizeWidget.prototype.setStoreProductTypeName=function(storeProductTypeName){return this.storeProductTypeName=storeProductTypeName};VirtusizeWidget.prototype.isValidProduct=function(){return this.validProduct};VirtusizeWidget.prototype.setValidProduct=function(validProduct){return this.validProduct=validProduct};VirtusizeWidget.prototype.isActive=function(){return this.active};VirtusizeWidget.prototype.isTestGroup=function(){var last_bid_char,ref,vs;vs=integration.VirtusizeSingleton.get();try{if(ref=vs.apiKey,indexOf.call(this.ab_test_participants,ref)>=0){last_bid_char=vs.bid.slice(-1);return last_bid_char.length===1&&"0123".indexOf(last_bid_char.toLowerCase())>-1}}catch(error){}return false};VirtusizeWidget.prototype.setActive=function(active){return this.active=active};VirtusizeWidget.prototype.doFetchMetaData=function(){return this.fetchMetaData};VirtusizeWidget.prototype.setFetchMetaData=function(fetchMetaData){return this.fetchMetaData=fetchMetaData};VirtusizeWidget.prototype.getUserEventData=function(){return this.userEventData};VirtusizeWidget.prototype.setUserEventData=function(userEventData){return this.userEventData=userEventData};VirtusizeWidget.prototype.isAddToCartEnabled=function(){return this.addToCartEnabled};VirtusizeWidget.prototype.setAddToCartEnabled=function(addToCartEnabled){return this.addToCartEnabled=addToCartEnabled};VirtusizeWidget.prototype.getLanguage=function(){return this.language};VirtusizeWidget.prototype.setLanguage=function(language){return this.language=language?language:"default"};VirtusizeWidget.prototype.getRegion=function(){return this.region};VirtusizeWidget.prototype.setRegion=function(region){return this.region=region?region:"default"};VirtusizeWidget.prototype.getAvailableSizes=function(){return this.availableSizes};VirtusizeWidget.prototype.setAvailableSizes=function(availableSizes){if(utils.$.isArray(availableSizes)){return this.availableSizes=availableSizes}else{if(availableSizes===undefined||availableSizes===null){return this.availableSizes=null}}};VirtusizeWidget.prototype.getSizeAliases=function(){return this.sizeAliases};VirtusizeWidget.prototype.setSizeAliases=function(sizeAliases){if(typeof sizeAliases==="object"&&!utils.$.isArray(sizeAliases)){return this.sizeAliases=sizeAliases}};VirtusizeWidget.prototype.on=function(eventName,callback){var callbackList;callbackList=this.callbacks[eventName]||[];callbackList.push(callback);this.callbacks[eventName]=callbackList;this.handleEvent("integration-registered-callback",{eventName:eventName})};VirtusizeWidget.prototype.off=function(eventName,callback){var callbackList,cb,i,j,len;if(eventName==null){return}this.handleEvent("integration-unregistered-callback",{eventName:eventName});if(callback==null){this.callbacks[eventName]=[];return}callbackList=this.callbacks[eventName]||[];for(i=j=0,len=callbackList.length;j<len;i=++j){cb=callbackList[i];if(cb===callback){callbackList.splice(i,1)}}this.callbacks[eventName]=callbackList};VirtusizeWidget.prototype.handleEvent=function(eventName,data){var callback,callbackList,callbacks,j,len,results;callbacks=this.callbacks;if(!utils.$.isArray(callbacks[eventName])){return}callbackList=callbacks[eventName];results=[];for(j=0,len=callbackList.length;j<len;j++){callback=callbackList[j];try{results.push(callback.apply(this,[data]))}catch(error){}}return results};VirtusizeWidget.prototype.open=function(options){if(options==null){options={}}options=utils.$.extend({detached:false},options);this.detached=options.detached;this.closeTooltip();this.setActive(true);view.openWidget(this);return this.handleEvent("user-opened-widget")};VirtusizeWidget.prototype.close=function(){this.setActive(false);view.closeWidget(this);this.detached=false;return this.handleEvent("user-closed-widget")};VirtusizeWidget.prototype.isTooltipEnabled=function(){return this.tooltipEnabled};VirtusizeWidget.prototype.setTooltipEnabled=function(tooltipEnabled){return this.tooltipEnabled=tooltipEnabled};VirtusizeWidget.prototype.setTooltipPosition=function(tooltipPosition){return this.tooltipPosition=tooltipPosition};VirtusizeWidget.prototype.getTooltipPosition=function(){return this.tooltipPosition};VirtusizeWidget.prototype.setTooltipStyle=function(tooltipStyle){return this.tooltipStyle=tooltipStyle};VirtusizeWidget.prototype.getTooltipStyle=function(){return this.tooltipStyle};VirtusizeWidget.prototype.getTooltipOpenDelay=function(){return this.tooltipOpenDelay};VirtusizeWidget.prototype.setTooltipOpenDelay=function(tooltipOpenDelay){return this.tooltipOpenDelay=tooltipOpenDelay};VirtusizeWidget.prototype.getTooltipCloseDelay=function(){return this.tooltipCloseDelay};VirtusizeWidget.prototype.setTooltipCloseDelay=function(tooltipCloseDelay){return this.tooltipCloseDelay=tooltipCloseDelay};VirtusizeWidget.prototype.checkPurchaseHistory=function(){return api.createPurchaseHistoryCheck(this)};VirtusizeWidget.prototype.setDebugTooltipData=function(skipData){if(skipData==null){skipData=false}view.injectTooltipStyle();if(!skipData){this.tooltipData.visible=true;return this.tooltipData.orderItemDebugImageUrl=this.getProductImageUrl()||ogp.parse().image}};VirtusizeWidget.prototype.openTooltip=function(data){var closeDelay,openDelay;this.tooltipData=data!=null?data:this.tooltipData;if(this.tooltipData!=null&&this.tooltipData.visible&&!utils.isFromFindByFit()){openDelay=this.getTooltipOpenDelay();closeDelay=this.getTooltipCloseDelay();if(utils.isNumeric(openDelay)){window.setTimeout(function(_this){return function(){return view.openTooltip(_this)}}(this),openDelay)}if(utils.isNumeric(closeDelay)){return window.setTimeout(function(_this){return function(){return _this.closeTooltip()}}(this),closeDelay+(utils.isNumeric(openDelay)?openDelay:0))}}};VirtusizeWidget.prototype.closeTooltip=function(){if(utils.$(".vs-tooltip").is(":visible")){return view.closeTooltip(this)}};VirtusizeWidget.prototype.showInpage=function(){var addEventListener,last_bid_char,openWidget,vs;if(this.getStoreName()==="marui"){vs=integration.VirtusizeSingleton.get();try{last_bid_char=vs.bid.slice(-1);if(last_bid_char.length===1&&"0123456789abcdefgh".indexOf(last_bid_char.toLowerCase())>-1){return false}}catch(error){return false}}window.vs.inpage={storeId:this.getStoreId(),storeProductId:this.getStoreProductId(),containerSelector:this.getInpageSelector()};openWidget=this.open.bind(this);addEventListener=this.on.bind(this);return utils.loadScript(utils.urlFor("/a/inpage/v1/integration.min.js"),function(){return window.vs.inpage.runIntegration({container:window.vs.inpage.containerSelector,openWidget:openWidget,addEventListener:addEventListener})})};VirtusizeWidget.prototype.showFindByFitInfo=function(){var $fbfInfo,$refText,$scoreEl,language,refName,refTypeId,score,size,text;size=utils.getFindByFitSize();score=utils.getFindByFitScore();refName=utils.getFindByFitRef()||"";language=this.getLanguage();if(language==="default"){language=utils.browserLanguage().split("-")[0]}refTypeId=this.getStoreProductTypeId();text=utils.getFindbyFitDoughnutText(size,score,refName,refTypeId,language);if(!size||!score||!text){return}$fbfInfo=utils.$('<div id="virtusize-fbf"/>');$refText=utils.$('<button class="vs-btn" type="button">'+text+"</button>");$scoreEl=utils.$('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" class="vs-svg"><g>'+'<circle class="vs-score" r="15.915" cx="22" cy="22" transform="rotate(-90 22,22)" style="stroke-dashoffset: '+(100-score)+'px"></circle>'+'<circle class="vs-bg" r="13.415" cx="22" cy="22"></circle>'+'<text x="22" y="26" text-anchor="middle" class="vs-txt">'+score+"%</text></g></svg>");$fbfInfo.bind("click",function(){return this.open()}.bind(this));$fbfInfo.append($scoreEl);$fbfInfo.append($refText);$fbfInfo.appendTo(utils.$(this.getFindByFitSelector()));return this.handleEvent("find-by-fit-select-size",{size:size})};VirtusizeWidget.prototype.validate=function(){this.errors=[];if(!this.productId){this.errors.push(new utils.Error("VirtusizeWidget","productId is undefined"))}if(!this.buttonSelector){this.errors.push(new utils.Error("VirtusizeWidget","buttonSelector is undefined"))}if(!(this.buttons!=null&&this.buttons.length>0)){this.errors.push(new utils.Error("VirtusizeWidget","buttons do not exist"))}return this.errors};return VirtusizeWidget}();return widget}(widget||{});var api;api=function(api){var apiPrefix,backendApiPrefix,eventsEndpoint,productCheckEndpoint,productMetaDataEndpoint,purchaseHistoryCheckEndpoint;apiPrefix="/a/api/v3/";backendApiPrefix="/rest-api/v1/";eventsEndpoint=apiPrefix+"events";productMetaDataEndpoint=backendApiPrefix+"product-meta-data-hints";purchaseHistoryCheckEndpoint=backendApiPrefix+"purchase-history-checks";productCheckEndpoint="/integration/v3/product-data-check";api.createEvent=function(name,widget){var data,vs;vs=integration.VirtusizeSingleton.get();data={type:"user",source:"integration",name:name,apiKey:vs.apiKey,storeId:widget.getStoreId(),storeName:widget.getStoreName(),storeDomain:utils.origin,integrationVersion:vs.integrationVersion,snippetVersion:vs.snippetVersion,storeProductType:widget.getStoreProductTypeName(),storeProductExternalId:widget.getProductId(),browserResolution:mobile.getResolution(window),browserOrientation:mobile.getOrientation(window),userCohort:utils.readOrCreateCohort(),widgetType:api.guessWidgetType()};data=utils.$.extend({},data,widget.getUserEventData());return proxy.backendRequest("POST",eventsEndpoint,data,"application/json")};api.createProductMetaData=function(data){return proxy.backendRequest("POST",productMetaDataEndpoint,data,"application/json")};api.createPurchaseHistoryCheck=function(widget){var data,vs;vs=integration.VirtusizeSingleton.get();data={bid:vs.bid,externalUserId:vs.userId,storeId:widget.getStoreId(),productId:widget.getProductId(),language:widget.getLanguage(),has_tooltip:widget.isTooltipEnabled()};return proxy.backendRequest("POST",purchaseHistoryCheckEndpoint,data,"application/json")};api.createProductCheck=function(widget){var vs;vs=integration.VirtusizeSingleton.get();return proxy.backendRequest("GET",productCheckEndpoint,{apiKey:vs.apiKey,externalId:widget.getProductId(),version:widget.getProductVersion(),externalUserId:vs.userId})};api.request=function(method,endpoint,data){return proxy.backendRequest(method,apiPrefix+endpoint,data,"application/json")};api.guessWidgetType=function(){var type,vs;vs=integration.VirtusizeSingleton.get();type="desktop";if(vs.isMobile()){type="mobile"}return type};return api}(api||{});var order,hasProp={}.hasOwnProperty;order=function(order){order.Item=function(){function Item(data){if(data==null){data={}}this.productId=null;this.size=null;this.sizeAlias=null;this.variantId=null;this.imageUrl=null;this.color=null;this.gender=null;this.unitPrice=null;this.quantity=null;this.url=null;this.errors=[];utils.$.extend(this,data)}Item.prototype.shorten=function(){var key,ref,res,value;res={};ref=this;for(key in ref){if(!hasProp.call(ref,key))continue;value=ref[key];if(key!=="errors"&&value!=null){res[this.shortName(key)]=value}}return res};Item.prototype.shortName=function(name){switch(name){case"productId":return"p";case"size":return"s";case"sizeAlias":return"a";case"variantId":return"v";case"imageUrl":return"i";case"color":return"c";case"gender":return"g";case"unitPrice":return"u";case"quantity":return"q";case"url":return"r";case"currency":return"d";default:return name}};Item.prototype.validate=function(){this.errors=[];if(!this.productId){this.errors.push(new utils.Error("OrderItem","productId is undefined"))}if(!this.size){this.errors.push(new utils.Error("OrderItem","size is undefined"))}if(!this.imageUrl){this.errors.push(new utils.Error("OrderItem","imageUrl is undefined"))}if(this.unitPrice&&typeof this.unitPrice!=="number"){this.errors.push(new utils.Error("OrderItem","unitPrice must be a number"))}if(this.quantity&&typeof this.quantity!=="number"){this.errors.push(new utils.Error("OrderItem","quantity must be a number"))}return this.errors};return Item}();order.Order=function(){function Order(data){if(data==null){data={}}this.apiKey=null;this.orderId=null;this.userId=null;this.region=null;this.totalItems=null;this.currentChunk=null;this.items=[];this.errors=[];if(data.items!=null){this.addItems(data.items);delete data.items}utils.$.extend(this,data);this.initialize()}Order.prototype.initialize=function(){return view.insertPixelChunks(this)};Order.prototype.getApiKey=function(){return this.apiKey};Order.prototype.setApiKey=function(apiKey){return this.apiKey=apiKey};Order.prototype.getOrderId=function(){return this.orderId};Order.prototype.setOrderId=function(orderId){return this.orderId=orderId};Order.prototype.getUserId=function(){return this.userId};Order.prototype.setUserId=function(userId){return this.userId=userId};Order.prototype.getRegion=function(){return this.region};Order.prototype.setRegion=function(region){return this.region=region};Order.prototype.getItems=function(){return this.items};Order.prototype.setItems=function(items){return this.items=items};Order.prototype.addItems=function(data){var item,j,len,results;results=[];for(j=0,len=data.length;j<len;j++){item=data[j];results.push(this.addItem(item))}return results};Order.prototype.addItem=function(data){return this.items.push(new order.Item(data))};Order.prototype.itemChunks=function(items,chunkSize){var i,res;if(chunkSize==null){chunkSize=3}res=[];i=0;while(i<items.length){res.push(items.slice(i,i+chunkSize));i+=chunkSize}return res};Order.prototype.shorten=function(chunk){var item,items,j,key,len,ref,res,value;this.totalItems=this.items.length;items=chunk!=null?chunk:this.items;res={};ref=this;for(key in ref){if(!hasProp.call(ref,key))continue;value=ref[key];if(key!=="errors"&&value!=null){res[this.shortName(key)]=value}}if(res.c){res.c=res.c.shorten()}res.i=[];for(j=0,len=items.length;j<len;j++){item=items[j];res.i.push(item.shorten())}if(res.i.length===0){delete res.i}return res};Order.prototype.shortenChunks=function(chunkSize){var chunk,chunks,i,j,len,res;chunks=this.itemChunks(this.items,chunkSize);this.totalChunks=chunks.length;res=[];for(i=j=0,len=chunks.length;j<len;i=++j){chunk=chunks[i];this.currentChunk=i;res.push(this.shorten(chunk))}return res};Order.prototype.shortName=function(name){switch(name){case"apiKey":return"a";case"orderId":return"o";case"userId":return"u";case"region":return"r";case"cost":return"c";case"totalItems":return"ti";case"totalChunks":return"tc";case"currentChunk":return"cc";case"items":return"i";default:return name}};Order.prototype.validate=function(){var item,j,len,ref,ref1;this.errors=[];if(!this.apiKey){this.errors.push(new utils.Error("Order","apiKey is undefined"))}if(!this.orderId){this.errors.push(new utils.Error("Order","orderId is undefined"))}if(!this.userId){this.errors.push(new utils.Error("Order","userId is undefined"))}else if((ref=this.userId.toLowerCase())==="guest"||ref==="anonymous"){this.errors.push(new utils.Error("Order","userId must be unique"))}ref1=this.items;for(j=0,len=ref1.length;j<len;j++){item=ref1[j];this.errors=this.errors.concat(item.validate())}return this.errors};return Order}();return order}(order||{});var cookie;cookie=function(cookie){cookie.write=function(key,value,options){var days,t;if(value!=null&&!utils.$.isFunction(value)){options=utils.$.extend({expires:1,path:"/"},options);if(typeof options.expires==="number"){days=options.expires;t=options.expires=new Date;t.setDate(t.getDate()+days)}return document.cookie=[encodeURIComponent(key),"=",String(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}return null};cookie.read=function(key){var c,cookies,i,len,name,parts;cookies=document.cookie?document.cookie.split("; "):[];for(i=0,len=cookies.length;i<len;i++){c=cookies[i];parts=c.split("=");name=decodeURIComponent(parts.shift());if(key!=null&&key===name){return parts.join("=")}}return null};cookie.remove=function(key,options){if(cookie.read(key===null)){return false}cookie.write(key,"",utils.$.extend({},options,{expires:-1}));return!cookie.read(key)};return cookie}(cookie||{});var proxy;proxy=function(proxy){proxy.setupReceiveMessage=function(next,error,context){var validOrigin;validOrigin=utils.urlFor("");utils.$(window).unbind("message.virtusize");utils.$(window).bind("message.virtusize",function(e){e=e.originalEvent;if(e.origin!==validOrigin){return false}if(typeof e.data!=="undefined"&&e.data!==null&&e.data){try{return proxy.receiveEvent(JSON.parse(e.data),context)}catch(error1){}}});return next(false,context)};proxy.receiveEvent=function(ev,context){var key,ref,value,widget;widget=proxy.selectWidget(ev,function(){var ref,results;ref=context.vs.widgets;results=[];for(key in ref){value=ref[key];results.push(value)}return results}());if(widget!=null){switch(ev.name){case"util-set-cookie":context.vs.environment.cookiesDisabled=false;widget.open();break;case"widget-requested-close":widget.close();break;case"backend-checked-product":widget.productChecked(ev.data);break;case"backend-checked-purchase-history":widget.openTooltip(ev.data)}if((ref=ev.name)!=="user-saw-widget-button"){widget.handleEvent(ev.name,ev.data)}}switch(ev.name){case"util-checked-environment":context.vs.environment=ev.data;return context.vs.bid=bid.readOrCreate(context.vs.environment.bid);case"user-requested-wardrobe":return widget.open()}};proxy.backendRequest=function(type,url,data,contentType){var ev,utilIFrame;ev={url:url,type:type,name:"integration-called-backend",contentType:contentType?contentType:"application/x-www-form-urlencoded",data:data};utilIFrame=utils.$('iframe[name="'+view.utilIFrameName+'"]')[0].contentWindow;return utilIFrame.postMessage(JSON.stringify(ev),utils.urlFor(""))};proxy.selectWidget=function(ev,widgetList){var i,j,len,len1,vsWidget;if(widgetList.length===1){return widgetList[0]}else if(ev.productId!=null){for(i=0,len=widgetList.length;i<len;i++){vsWidget=widgetList[i];if(ev.productId===vsWidget.getProductId()){return vsWidget}}}else{for(j=0,len1=widgetList.length;j<len1;j++){vsWidget=widgetList[j];if(vsWidget.isActive()===true){return vsWidget}}}};return proxy}(proxy||{});var mobile;mobile=function(mobile){mobile.isMobile=null;mobile.iframe=null;mobile.orientation=null;mobile.iFrameTemplate='<iframe id="virtusize-widget-iframe" name="virtusize-widget-iframe" frameborder="0" title="Fit Illustrator by Virtusize" role="application"></iframe>';mobile.page={viewport:null,dom:null,visible:true,style:null,scrollPosition:0};mobile.init=function(){mobile.page.viewport=utils.$("head meta[name=viewport]");mobile.page.dom=utils.$("body > *:visible");mobile.page.style=utils.$("body").attr("style")!=null?utils.$("body").attr("style"):null;mobile.page.htmlstyle=utils.$("html").attr("style")!=null?utils.$("html").attr("style"):null;return mobile.orientation=mobile.getOrientation(window)};mobile.registerHandlers=function(){mobile.unregisterHandlers();utils.$(window).bind("orientationchange.virtusize",mobile.onOrientationChange);return utils.$(window).bind("resize.virtusize",mobile.onResize)};mobile.unregisterHandlers=function(){utils.$(window).unbind("orientationchange.virtusize");return utils.$(window).unbind("resize.virtusize")};mobile.getIFrame=function(url){var iframe;iframe=utils.$(mobile.iFrameTemplate).attr("src",url);iframe.attr("src",url);iframe.appendTo(utils.$("body"));iframe.css({zIndex:2147483646,position:"absolute",left:0,top:0,background:"white",border:"none"});return iframe};mobile.openWidget=function(widget){this.init();mobile.hidePage();mobile.registerHandlers();mobile.iframe=mobile.getIFrame(view.constructWidgetURI(widget));utils.$("body").append(mobile.iframe);window.setTimeout(function(){return mobile.setIFrameDimensions(window)},100);window.setTimeout(function(){return mobile.setIFrameDimensions(window)},2100);return window.setTimeout(function(){return mobile.setIFrameDimensions(window)},5100)};mobile.openWidgetWindow=function(widget){return widget.win=view.openWindow(view.constructWidgetURI(widget))};mobile.closeWidget=function(widget){mobile.iframe.remove();mobile.iframe=null;mobile.unregisterHandlers();return mobile.showPage()};mobile.showPage=function(){if(!mobile.page.visible){if(mobile.page.viewport!=null&&mobile.page.viewport.length>0){utils.$("head meta[name=viewport]").remove();utils.$("head").append(mobile.page.viewport)}else{utils.$("head meta[name=viewport]").attr("content","width=device-width, initial-scale=0")}utils.$("body").attr("style",mobile.page.style);utils.$("html").attr("style",mobile.page.htmlstyle);mobile.page.dom.show();mobile.page.visible=true;return window.scrollTo(0,mobile.page.scrollposition)}};mobile.hidePage=function(){if(mobile.page.visible){mobile.page.scrollposition=window.pageYOffset!==null?window.pageYOffset:document.documentElement.scrollTop!==null?document.documentElement.scrollTop:document.body.scrollTop;mobile.page.dom.hide();mobile.page.viewport.remove();utils.$("body").attr("style",null);utils.$("html").attr("style","overflow: visible !important;");utils.$("body").css("background-color","white");utils.$("head").append('<meta name="viewport">');mobile.setViewport("landscape");return mobile.page.visible=false}};mobile.setIFrameDimensions=function(w){mobile.iframe.width(w.innerWidth);return mobile.iframe.height(Math.max(w.innerHeight,460))};mobile.onOrientationChange=function(){mobile.orientation=mobile.getOrientation(window);return mobile.setViewport(mobile.orientation)};mobile.onResize=function(){return window.setTimeout(function(){return mobile.setIFrameDimensions(window)},200)};mobile.setViewport=function(orientation){if(orientation==="portrait"){return utils.$("head meta[name=viewport]").attr("content","width=device-width, initial-scale=1.0")}else{return utils.$("head meta[name=viewport]").attr("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0")}};mobile.getOrientation=function(w){if(w.matchMedia){if(w.matchMedia("(orientation: landscape)").matches){return"landscape"}else{return"portrait"}}else{if(w.innerWidth){if(w.innerWidth>w.innerHeight){return"landscape"}else{return"portrait"}}else{if(w.document.documentElement.clientWidth>w.document.documentElement.clientHeight){return"landscape"}else{return"portrait"}}}};mobile.getResolution=function(w){if(w.screen.width>w.screen.height){return w.screen.width+"x"+w.screen.height}else{return w.screen.height+"x"+w.screen.width}};return mobile}(mobile||{});var utils;utils=function(utils){var $,allowedMobileVersions,d,jQueryUri,origin,tldRegex,vsCDNHost,vsHost,vsIntegrationVersion,w;d=document;w=window;$=null;allowedMobileVersions={ios:[7,0,4],android:[4,4,4]};jQueryUri="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js";origin=w.location.protocol+"//"+w.location.host;vsHost="www.virtusize.com";vsCDNHost="https://cdn.api.virtusize.com";vsIntegrationVersion="4.12.1";tldRegex=/[^.]*\.([^.]*|..\...|...\...)$/;utils.origin=origin;utils.vsIntegrationVersion=vsIntegrationVersion;utils.cohortCookieKey="vs.cohort";utils.cohortCookieExpiresInDays=7;utils.ensureJQuery=function(next,error,context){if(typeof w.jQuery!=="undefined"){context.$=utils.$=$=w.jQuery;return next(false,context)}else{return utils.loadScript(jQueryUri,function(){context.$=utils.$=$=w.jQuery.noConflict();return next(false,context)})}};utils.debug=function(next,error,context){var vsHash;vsHash=null;if(utils.hasHashtag("hasVsWidget")){vsHash="hasVsWidget"}else if(utils.hasHashtag("debugOgp")){vsHash="debugOgp"}else if(utils.hasHashtag("vsDebug")){vsHash="vsDebug"}if(vsHash){window.setTimeout(function(){var msg,pre,productId,ref,ul,ulProd,widget;msg=utils.$('<div id="virtusize-debug-msg" style="text-align: left; position:fixed; top: 10%; width: 50%; height: 80%; left: 25%; background:#fff; border: 1px solid #ccc; box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3); padding: 10px 25px; z-index: 10000; overflow-y: auto;"></div>');if(vsHash==="hasVsWidget"){msg.append("<h3>Virtusize Widget has successfully integrated</h3>");msg.append("<p>API key: "+vs.apiKey+"</p>");msg.append("<p>Integration version: "+vs.integrationVersion+"</p>");msg.append("<p>Snippet version: "+vs.snippetVersion+"</p>");msg.append("<p>Number of widgets: "+Object.keys(context.vs.widgets).length+"</p>");ul=utils.$("<ul></ul>");ref=context.vs.widgets;for(productId in ref){widget=ref[productId];ul.append("<li><strong>Product "+productId+"</strong></li>");ulProd=utils.$("<ul></ul>");ulProd.append("<li>Is Valid Product: "+widget.isValidProduct()+"</li>");ulProd.append("<li>Language: "+widget.getLanguage()+"</li>");ulProd.append("<li>Region: "+widget.getRegion()+"</li>");ulProd.append("<li>Available Sizes: "+widget.getAvailableSizes()+"</li>");ulProd.append("<li>Size Aliases: "+widget.getSizeAliases()+"</li>");ul.append(ulProd)}msg.append(ul);msg.append("<p><button onclick=\"$('#virtusize-debug-msg').fadeOut(function() { $('#virtusize-debug-msg').remove()});\">Dismiss</button></p>");return utils.$("body").append(msg)}else if(vsHash==="debugOgp"){msg.append("<h3>Open Graph Metadata</h3>");pre=utils.$("<pre></pre>");pre.text(JSON.stringify(ogp.parse(),null,4));msg.append(pre);msg.append("<p><button onclick=\"$('#virtusize-debug-msg').fadeOut(function() { $('#virtusize-debug-msg').remove()});\">Dismiss</button></p>");return utils.$("body").append(msg)}},2e3);if(vsHash==="vsDebug"){utils.loadScript("https://rawgit.com/virtusize/bookmarklets/master/build/override.min.js")}}return next(false,context)};utils.checkBrowser=function(next,error,context){context.vs.isModernBrowser=utils.isModernBrowser();return next(false,context)};utils.checkEnvironment=function(next,error,context){if(context.vs.isModernBrowser){return view.createUtilIFrame(function(e){return next(false,context)},context)}else{return next(false,context)}};utils.checkMobileVersion=function(next,error,context){var ua;ua=navigator.userAgent;if(!utils.isLegacySystem(ua)){return next(false,context)}};utils.isLegacySystem=function(ua){var e,version;try{if(ua.match(/iPhone/i)||ua.match(/iPod/i)||ua.match(/iPad/i)){version=ua.match(/OS\s([0-9\_]*[0-9])\slike/)[1].split("_");if(!utils.isAllowedMobileVersion(allowedMobileVersions.ios,version)){return true}}else if(ua.match(/Android/i)){version=ua.match(/Android\s([0-9\.]*[0-9])/)[1].split(".");if(!utils.isAllowedMobileVersion(allowedMobileVersions.android,version)){return true}}else if(ua.match(/MSIE\s*[7|8|6|5]/i)){return true}}catch(error1){e=error1;return true}return false};utils.isAllowedMobileVersion=function(checkAgainst,versionToCheck){var addZeroes,i,j,lengthDiff,ref,version;if(!utils.$.isArray(checkAgainst)||!utils.$.isArray(versionToCheck)){return false}addZeroes=function(array,noOfZeroes){var i,j,ref;for(i=j=0,ref=noOfZeroes-1;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j){array.push(0)}};lengthDiff=checkAgainst.length-versionToCheck.length;if(lengthDiff>0){addZeroes(versionToCheck,lengthDiff)}else if(lengthDiff<0){addZeroes(checkAgainst,-lengthDiff)}for(i=j=0,ref=checkAgainst.length;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j){version=parseInt(versionToCheck[i]);if(isNaN(parseFloat(version))&&isFinite(version)){return false}if(version>checkAgainst[i]){return true}if(version<checkAgainst[i]){return false}if(version===checkAgainst[i]){if(versionToCheck.length!==i+1){continue}return true}}return false};utils.sendProductMetadata=function(widget){var data,link,ogpData,vs;ogpData=ogp.parse();data={};if(ogpData.image||ogpData["image:url"]||widget.getProductImageUrl()!=null){vs=integration.VirtusizeSingleton.get();data.ogp=ogpData;link=utils.$('link[rel="canonical"]');if(link.length>0){data.canonicalUrl=link.attr("href")}data.externalId=widget.getProductId();if(widget.getProductImageUrl()!=null){data.imageUrl=widget.getProductImageUrl()}data.storeId=widget.getStoreId();data.apiKey=vs.apiKey;return api.createProductMetaData(data)}};utils.tryTwice=function(work,retryCondition){return function(next,error,result){var _next;_next=function(_error,_result){if(_error){retryCondition=retryCondition||utils.$(d).ready;return retryCondition(function(){return work(next,error,result)})}else{return next(_error,_result)}};return work(_next,error,result)}};utils.urlFor=function(path,cdn){return(cdn?vsCDNHost:"https://"+vsHost)+path};utils.browserLanguage=function(){if(navigator.language){return navigator.language}else{return navigator.userLanguage}};utils.uriParam=function(uri,name){var match;match=new RegExp("[?&]"+name+"=([^&]*)").exec(uri);if(match){return decodeURIComponent(match[1].replace(/\+/g," "))}else{return null}};utils.loadScript=function(uri,callback){var firstScript,s,script;s="script";firstScript=d.getElementsByTagName(s)[0];script=d.createElement(s);script.async=true;script.type="text/javascript";script.src=uri;script.onload=script.onreadystatechange=function(ignore,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(script.parentNode){script.parentNode.removeChild(script)}script=undefined;if(!(isAbort||callback==null)){return callback()}}};return firstScript.parentNode.insertBefore(script,firstScript)};utils.isModernBrowser=function(){return!!window.postMessage&&!!window.JSON&&!!JSON.stringify};utils.hasHashtag=function(hashTag){return w.location.hash&&w.location.hash.indexOf("#"+hashTag)===0};utils.isFromFindByFit=function(){return utils.uriParam(window.location,utils.cohortCookieKey)==="findbyfit"};utils.getFindByFitSize=function(){if(!utils.isFromFindByFit()){return false}return utils.uriParam(window.location,"size")};utils.getFindByFitScore=function(){var score;if(!utils.isFromFindByFit()){return false}score=utils.uriParam(window.location,"score");return parseInt(score,10)||false};utils.getFindByFitRef=function(){if(!utils.isFromFindByFit()){return false}return utils.uriParam(window.location,"ref")};utils.getFindbyFitDoughnutText=function(size,score,refName,typeId,lang){var tmpl,types;types={sv:{2:"skjorta",3:"tröja",4:"t-shirt",5:"byxor",13:"shorts"},en:{2:"shirt",3:"sweater",4:"t-shirt",5:"pants",13:"shorts"},ja:{2:"シャツ",3:"セーター",4:"Tシャツ",5:"パンツ",13:"ショーツ"}};if(!(lang in types)||!(typeId in types[lang])){return}tmpl={sv:"Storlek <span>"+size+"</span> passar "+score+"% som "+(typeId===5||typeId===13?"dina ":"din ")+refName+" "+types[lang][typeId]+".",en:"Size <span>"+size+"</span> fits "+score+"% like your "+refName+" "+types[lang][typeId]+".",ja:"サイズ<span>"+size+"</span>のフィット感は"+refName+" ("+types[lang][typeId]+")の"+score+"%です。"};return tmpl[lang]};utils.readOrCreateCohort=function(){var cohort;cohort=utils.uriParam(window.location,utils.cohortCookieKey);if(cohort==null){cohort="direct"}return cohort};utils.isNumeric=function(obj){return!utils.$.isArray(obj)&&obj-parseFloat(obj)>=0};utils.isPlainObject=function(obj){if(obj==null||typeof obj!=="object"||obj.nodeType||obj!==null&&obj===obj.window){return false}if(obj.constructor&&!obj.constructor.prototype.hasOwnProperty("isPrototypeOf")){return false}return true};utils.buildParams=function(prefix,obj,add){var name,rbracket,results;rbracket=/\[\]$/;if(utils.$.isArray(obj)){return utils.$.each(obj,function(i,v){if(rbracket.test(prefix)){return add(prefix,v)}else{return utils.buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,add)}})}else if(utils.isPlainObject(obj)){results=[];for(name in obj){results.push(utils.buildParams(prefix+"["+name+"]",obj[name],add))}return results}else{return add(prefix,obj)}};utils.param=function(data){var add,prefix,r20,res;r20=/%20/g;res=[];add=function(key,value){value=value!=null?value:"";return res.push(encodeURIComponent(key)+"="+encodeURIComponent(value))};for(prefix in data){utils.buildParams(prefix,data[prefix],add)}return res.join("&").replace(r20,"+")};utils.Error=function(){function Error(source,message){this.source=source;this.message=message}Error.prototype.toString=function(){return"["+this.source+"]: "+this.message};return Error}();utils.hasErrorLogger=function(){return typeof console==="object"&&console.error};utils.logErrors=function(errors){var error,j,len,results;if(utils.$.isArray(errors)){results=[];for(j=0,len=errors.length;j<len;j++){error=errors[j];results.push(utils.logError(error))}return results}};utils.logError=function(error){if(utils.hasErrorLogger()){return console.error(typeof error==="string"?error:error.toString())}};utils.tld=function(hostname){var match;match=hostname.match(tldRegex);if(match){return"."+match[0]}else{return hostname}};return utils}(utils||{});var view;view=function(view){var createIFrameGet,iFrameStyleDefault,iFrameTemplate,oldBrowserWindowPath,overlayColorTemplate,overlayDefaultRgba,overlayDiv,overlayStyleId,overlayStylePostfix,overlayStylePrefix,styleIFrame,tooltipStyleId,tooltipStylePath,utilIFrameName,utilIFramePath,widgetFrameSize,widgetIFrameName,widgetOverlayId,widgetOverlayWrapperId,widgetPath,widgetSize;overlayDiv=null;overlayStyleId="vs-overlay-style";overlayStylePrefix="#virtusize-overlay,#virtusize-overlay-wrapper{position:fixed;top:0;left:0;width:100%;height:100%;z-index:2147483646;display:none}#virtusize-overlay{zoom:1;";overlayStylePostfix="}";overlayColorTemplate="background: %%rgba%%;";overlayDefaultRgba="rgba(0,0,0,0.5)";tooltipStyleId="vs-tooltip-style";tooltipStylePath="/integration/v4.min.css";widgetOverlayId="virtusize-overlay";widgetOverlayWrapperId="virtusize-overlay-wrapper";utilIFramePath="/integration/v3/util-iframe.html";utilIFrameName="virtusize-util-iframe";oldBrowserWindowPath="/integration/v3/update-browser.html";widgetIFrameName="virtusize-widget-iframe";widgetPath="https://www.virtusize.com/a/fit-illustrator/v1/index.html";widgetSize={w:960,h:610};widgetFrameSize={w:1022,h:650};view.imageId="vs-order-confirmation";view.imagePath="/integration/v3/image.gif?";view.utilIFrameName=utilIFrameName;view.showButtons=function(widget){var buttons;buttons=widget.getButtons();if(buttons!=null&&buttons.length){return buttons.css("visibility","visible").show()}};view.injectTooltipStyle=function(){var element;if(!utils.$("#"+tooltipStyleId).length){element=utils.$('<link id="'+tooltipStyleId+'" href="'+utils.urlFor(tooltipStylePath,true)+'" rel="stylesheet">');return element.appendTo(utils.$("head"))}};view.injectOverlayStyle=function(next,error,context){if(!utils.$("#"+overlayStyleId).length){view.injectOverlayStyles()}return next(false,context)};view.injectOverlayStyles=function(rgba){var element,styles;styles=overlayStylePrefix;styles+=overlayColorTemplate.replace(/%%rgba%%/g,rgba||overlayDefaultRgba);styles+=overlayStylePostfix;utils.$("#"+overlayStyleId).remove();element=utils.$('<style id="'+overlayStyleId+'" type="text/css">'+styles+"</style>");return element.appendTo(utils.$("head"))};styleIFrame=function(iFrame){return iFrame.css(iFrameStyleDefault()).css({position:"relative",width:widgetFrameSize.w,height:widgetFrameSize.h,margin:"0 auto",display:"block",top:"50%","margin-top":widgetFrameSize.h/-2+"px"})};iFrameTemplate=function(id){return'<iframe id="'+id+'" name="'+id+'" frameborder="0" allowtransparency="true" scrolling="no" onmousewheel="" title="Fit Illustrator by Virtusize" role="application"></iframe>'};iFrameStyleDefault=function(){return{overflow:"hidden","overflow-x":"hidden","overflow-y":"hidden",background:"transparent",border:"none"}};createIFrameGet=function(uri){var iFrame;iFrame=utils.$(iFrameTemplate(widgetIFrameName)).attr("src",uri);styleIFrame(iFrame);setTimeout(function(){return iFrame.focus()},100);return iFrame.appendTo(overlayDiv)};view.setupDomButtons=function(widget){var buttons,vs;vs=integration.VirtusizeSingleton.get();buttons=widget.getButtons();if(buttons!=null&&buttons.length>=0){if(buttons.is(":visible")&&buttons.css("visibility")==="visible"){buttons.css("visibility","hidden").hide()}buttons.unbind("click.virtusize");return buttons.bind("click.virtusize",function(ev){ev.preventDefault();if(!vs.isModernBrowser||!document.addEventListener){return view.openOldBrowserWindow(widget)}else{return widget.open({detached:vs.environment&&vs.environment.cookiesDisabled})}})}};view.createUtilIFrame=function(onLoadCallback,context){var fullUri,iFrameHtml,utilIFrame;fullUri=utils.urlFor(utilIFramePath+"?"+utils.param({origin:utils.origin,"vs.bid":context.vs.bid,_:(new Date).getTime()}));iFrameHtml='<iframe name="'+utilIFrameName+'" frameborder="0" allowtransparency="true" scrolling="no" style="width:0; height:0; position: absolute; left:-9999px;" width="0" height="0" role="application" aria-hidden="true"></iframe>';utilIFrame=utils.$(iFrameHtml);utilIFrame.attr("src",fullUri);if(utils.$.fn.on){utilIFrame.on("load",onLoadCallback)}else{utilIFrame.load(onLoadCallback)}if(utils.$("body").length===0){return utils.$(function(){return utils.$("body").append(utilIFrame)})}else{return utils.$("body").append(utilIFrame)}};view.openOldBrowserWindow=function(widget){return view.openWindow(utils.urlFor(oldBrowserWindowPath+"?"+utils.param({productId:widget.getProductId()})),500,350)};view.openWindow=function(url,width,height){var d,defaultFeatures,features,left,newWindow,outerHeight,outerWidth,screenX,screenY,top,w;w=window;d=document;if(width!=null&&height!=null){defaultFeatures="status=0,toolbar=0,location=0,menubar=0,directories=0,resizable=0,scrollbars=0";screenX=utils.isNumeric(w.screenX)?w.screenX:w.screenLeft;screenY=utils.isNumeric(w.screenY)?w.screenY:w.screenTop;outerWidth=utils.isNumeric(w.outerWidth)?w.outerWidth:d.body.clientWidth;outerHeight=utils.isNumeric(w.outerHeight)?w.outerHeight:d.body.clientHeight-22;left=parseInt(screenX+(outerWidth-width)/2,10);top=parseInt(screenY+(outerHeight-height)/2.5,10);features="width="+width+",height="+height+",left="+left+",top="+top+","+defaultFeatures}newWindow=w.open(url,"Virtusize",features);if(newWindow!=null){newWindow.focus()}return newWindow};view.openWidget=function(widget){var vs;vs=integration.VirtusizeSingleton.get();if(widget.detached){if(vs.isMobile()){return mobile.openWidgetWindow(widget)}else{return view.openWidgetWindow(widget)}}else if(vs.isMobile()){return mobile.openWidget(widget)}else{return view.openWidgetFrame(widget)}};view.openWidgetWindow=function(widget){return widget.win=view.openWindow(view.constructWidgetURI(widget),widgetSize.w,widgetSize.h)};view.openWidgetFrame=function(widget){overlayDiv=utils.$('<div id="'+widgetOverlayWrapperId+'"><div id="'+widgetOverlayId+'"></div></div>').appendTo("body").show().find("#"+widgetOverlayId).show();utils.$("#"+widgetOverlayWrapperId).click(function(){return widget.close()});return createIFrameGet(view.constructWidgetURI(widget))};view.closeWidget=function(widget){var vs;vs=integration.VirtusizeSingleton.get();if(widget.detached&&widget.win!=null){try{widget.win.close();return window.focus()}catch(error1){}}else if(vs.isMobile()){return mobile.closeWidget(widget)}else{utils.$("#"+widgetIFrameName).add("#"+widgetOverlayWrapperId).remove();return widget.getButtons().focus()}};view.constructWidgetURI=function(widget,timestamp,origin){var options,urlParts,vs;timestamp=timestamp?timestamp:(new Date).getTime();origin=origin?origin:utils.origin;urlParts=[widget.getLanguage()+"_"+widget.getRegion(),widget.getStoreId(),widget.getStoreProductId()];options={origin:origin,detached:widget.detached,bid:bid.read(),addToCartEnabled:widget.isAddToCartEnabled(),storeId:widget.getStoreId(),_:timestamp};if(widget.isTooltipEnabled()&&widget.tooltipData!=null&&widget.tooltipData.visible&&widget.tooltipData.orderItemId){options.oid=widget.tooltipData.orderItemId}if(widget.getAvailableSizes()){if(utils.$.isArray(widget.getAvailableSizes())&&widget.getAvailableSizes().length===0){options.as="null"}else{options.as=widget.getAvailableSizes()}}if(widget.getSizeAliases()){options.sa=widget.getSizeAliases()}vs=integration.VirtusizeSingleton.get();if(vs.userId){options.userId=vs.userId}options.spid=widget.getStoreProductId();options.lang=widget.getLanguage();return widgetPath+"?"+utils.param(options)};view.insertPixelChunks=function(order,async){var chunk,chunks,f,g,i,k,len,vs;if(async==null){async=true}vs=integration.VirtusizeSingleton.get();chunks=order.shortenChunks();for(i=k=0,len=chunks.length;k<len;i=++k){chunk=chunks[i];f=function(){var j,params;j=i;params=utils.$.extend({"vs.bid":vs.bid},chunk);return function(){return view.insertPixel(params,j)}};g=f();if(async){setTimeout(g,i*500)}else{g()}}};view.insertPixel=function(params,i){var paramString;paramString=utils.param(params);return utils.$("body").append('<img id="'+view.imageId+"-"+(i+1)+'" style="width:0; height:0;" src="'+utils.urlFor(view.imagePath+paramString)+'" alt="" />')};view.openTooltip=function(widget){var content,data,el,i18n,imageUrl,ref,template,vs;data=widget.tooltipData;i18n=data.i18n.shared.purchaseHistory.tooltip;imageUrl="https://res.cloudinary.com/virtusize/image/upload/t_product-popup-v1/"+data.cloudinaryPublicId+".jpg";imageUrl=(ref=data.orderItemDebugImageUrl)!=null?ref:imageUrl;template='<div class="vs-tooltip" role="tooltip"><div class="vs-tooltip-arrow"></div><div class="vs-tooltip-content"></div></div>';content='<img src="'+imageUrl+'" class="pull-left" /><button type="button" class="vs-tooltip-close">&times;</button>';el=utils.$(template);vs=integration.VirtusizeSingleton.get();if(vs.isMobile()){el.addClass("mini");content+="<p>"+i18n.miniTitle+"</p>"}else{content+="<h3>"+i18n.title+"</h3><p>"+i18n.text+"</p>"}if(widget.getTooltipStyle()==="light"){el.addClass("vs-tooltip-light")}el.addClass(widget.getTooltipPosition());el.find(".vs-tooltip-content").html(content);el.bind("click",function(ev){ev.stopPropagation();ev.preventDefault();return widget.open()});el.find(".vs-tooltip-content button").bind("click",function(ev){ev.stopPropagation();ev.preventDefault();return view.closeTooltip()});el.insertAfter(widget.buttons);el.fadeIn();return view.positionTooltip(widget.buttons,el,widget.getTooltipPosition())};view.positionTooltip=function(buttons,popup,placement){var alignment,buttonPos,popupPos;buttonPos=view.getPosition(buttons);popupPos=view.getPosition(popup);popup.offset(view.calculateOffset(buttonPos,popupPos,popup,"center",placement));popupPos=view.getPosition(popup);alignment=view.getAlignment(buttonPos,popupPos);if(alignment!=="center"){popup.offset(view.calculateOffset(buttonPos,popupPos,popup,alignment,placement))}return popup.addClass("vs-tooltip-"+alignment)};view.closeTooltip=function(widget){return utils.$(".vs-tooltip").fadeOut()};view.getPosition=function(element){var el,elOffset,elRect,isBody,outerDims,scroll;el=element[0];isBody=el.tagName==="BODY";elRect=el.getBoundingClientRect();if(elRect.width==null){elRect=utils.$.extend({},elRect,{width:elRect.right-elRect.left,height:elRect.bottom-elRect.top})}elOffset=isBody?{top:0,left:0}:element.offset();scroll={scroll:isBody?document.documentElement.scrollTop||document.body.scrollTop:element.scrollTop()};outerDims=isBody?{width:utils.$(window).width(),height:utils.$(window).height()}:null;return utils.$.extend({},elRect,scroll,outerDims,elOffset)};view.calculateOffset=function(buttonPos,popupPos,popup,alignment,placement){var left,marginCompensation,top;marginCompensation=parseInt(popup.css("margin-top"));if(placement==="bottom"){top=buttonPos.top+buttonPos.height+marginCompensation}else{top=buttonPos.top-(popupPos.height-marginCompensation)}switch(alignment){case"center":left=buttonPos.left-popupPos.width/2+buttonPos.width/2;break;case"left":left=buttonPos.left;break;case"right":left=buttonPos.left-popupPos.width+buttonPos.width}return{top:Math.round(top),left:Math.round(left)}};view.getAlignment=function(buttonPos,popupPos){var alignment,bodyPos;bodyPos=view.getPosition(utils.$("body"));alignment="center";if(popupPos.left<0){alignment="left"}else if(popupPos.right>bodyPos.right){alignment="right"}return alignment};return view}(view||{});var bid,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};bid=function(bid){bid.cookieExpiresInDays=730;bid.cookieKey="vs.bid";bid.setOnContext=function(next,error,context){context.vs.bid=bid.readOrCreate();return next(false,context)};bid.readOrCreate=function(overrideValue){var uuid;uuid=overrideValue?overrideValue:bid.read();if(!uuid){uuid=bid.uuid()}bid.remove();bid.write(uuid);return uuid};bid.read=function(){return cookie.read(bid.cookieKey)};bid.write=function(uuid){return cookie.write(bid.cookieKey,uuid,{domain:utils.tld(window.location.hostname),expires:bid.cookieExpiresInDays})};bid.remove=function(){return cookie.remove(bid.cookieKey,{domain:utils.tld(window.location.hostname)})};bid.uuid=function(){var chars,i,j,radix,uuid;chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");radix=chars.length;uuid=[];for(i=j=0;j<=22;i=++j){uuid[i]=chars[0|Math.random()*radix]}return uuid.join("")+"."+(new Date).getTime().toString(36)};bid.isWithin=function(userBid,charCount){var chars,check,ref;if(charCount==null){charCount=36/2}if(userBid==null){return false}chars="0123456789abcdefghijklmnopqrstuvwxyz".split("");check=chars.splice(0,charCount);try{if(ref=userBid.slice(-1),indexOf.call(check,ref)>=0){return true}}catch(error1){}return false};return bid}(bid||{});flow.start()})();